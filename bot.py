import pandas as pd
import os

# æª”æ¡ˆåç¨±
FILE_NAME = 'football_data.csv'

def get_latest_data():
    """
    æ¨¡æ“¬æ•¸æ“šä¾†æºï¼šåŒ…å«è¿‘æ³ã€æ’åã€æ¯”åˆ†
    å°‡ä¾†è«‹åœ¨é€™è£¡æ¥å…¥ä½ çš„çœŸå¯¦çˆ¬èŸ²
    """
    return [
        {
            'æ™‚é–“': '19:30', 'è¯è³½': 'è‹±è¶…', 'ä¸»éšŠ': 'æ›¼åŸ', 'å®¢éšŠ': 'æ›¼è¯', 
            'ä¸»æ’å': 2, 'å®¢æ’å': 8,
            'ä¸»è¿‘æ³': 'W,W,D,W,W', 'å®¢è¿‘æ³': 'L,L,W,D,L', # ç´…ç¶ ç‡ˆæ•¸æ“š
            'ä¸»é æ¸¬': 2.1, 'å®¢é æ¸¬': 0.8, 'ç¸½çƒæ•¸': 2.9,
            'ä¸»æ”»(H)': 2.5, 'å®¢æ”»(A)': 1.1,
            'ç‹€æ…‹': 'å®Œå ´', 'ä¸»åˆ†': 3, 'å®¢åˆ†': 1, 'H2H': 'æ›¼åŸ 3å‹ 1å’Œ'
        },
        {
            'æ™‚é–“': '22:00', 'è¯è³½': 'è‹±è¶…', 'ä¸»éšŠ': 'åˆ©ç‰©æµ¦', 'å®¢éšŠ': 'è»Šè·¯å£«', 
            'ä¸»æ’å': 1, 'å®¢æ’å': 5,
            'ä¸»è¿‘æ³': 'W,W,W,W,W', 'å®¢è¿‘æ³': 'W,D,D,W,L',
            'ä¸»é æ¸¬': 1.8, 'å®¢é æ¸¬': 1.2, 'ç¸½çƒæ•¸': 3.0,
            'ä¸»æ”»(H)': 2.8, 'å®¢æ”»(A)': 1.5,
            'ç‹€æ…‹': 'é€²è¡Œä¸­', 'ä¸»åˆ†': 1, 'å®¢åˆ†': 1, 'H2H': 'åˆ©ç‰©æµ¦ 2å‹ 2å’Œ'
        },
        {
            'æ™‚é–“': '23:00', 'è¯è³½': 'è‹±è¶…', 'ä¸»éšŠ': 'é˜¿ä»™å¥´', 'å®¢éšŠ': 'ç†±åˆº', 
            'ä¸»æ’å': 3, 'å®¢æ’å': 4,
            'ä¸»è¿‘æ³': 'L,W,W,L,D', 'å®¢è¿‘æ³': 'W,W,W,W,W',
            'ä¸»é æ¸¬': 1.6, 'å®¢é æ¸¬': 1.4, 'ç¸½çƒæ•¸': 3.0,
            'ä¸»æ”»(H)': 1.9, 'å®¢æ”»(A)': 2.0,
            'ç‹€æ…‹': 'æœªé–‹è³½', 'ä¸»åˆ†': 0, 'å®¢åˆ†': 0, 'H2H': 'é›™æ–¹äº’æœ‰å‹è² '
        },
        {
            'æ™‚é–“': '01:45', 'è¯è³½': 'è¥¿ç”²', 'ä¸»éšŠ': 'çš‡é¦¬', 'å®¢éšŠ': 'å·´å¡', 
            'ä¸»æ’å': 2, 'å®¢æ’å': 1,
            'ä¸»è¿‘æ³': 'W,W,W,D,D', 'å®¢è¿‘æ³': 'W,W,W,W,W',
            'ä¸»é æ¸¬': 1.5, 'å®¢é æ¸¬': 1.6, 'ç¸½çƒæ•¸': 3.1,
            'ä¸»æ”»(H)': 2.2, 'å®¢æ”»(A)': 2.4,
            'ç‹€æ…‹': 'æœªé–‹è³½', 'ä¸»åˆ†': 0, 'å®¢åˆ†': 0, 'H2H': 'å·´å¡è¿‘å¹´ä½”å„ª'
        },
    ]

def update_csv():
    # 1. ç²å–æœ€æ–°æ•¸æ“š
    new_data = get_latest_data()
    print(f"ğŸ“¥ æŠ“å–åˆ° {len(new_data)} ç­†æ–°æ•¸æ“š...")

    # 2. å˜—è©¦è®€å–èˆŠæ•¸æ“š (Upsert é‚è¼¯)
    if os.path.exists(FILE_NAME):
        try:
            df_old = pd.read_csv(FILE_NAME)
            existing_data = df_old.to_dict('records')
        except:
            existing_data = []
    else:
        existing_data = []

    # 3. æ›´æ–°é‚è¼¯
    data_map = {row['ä¸»éšŠ']: row for row in existing_data}

    for new_row in new_data:
        team = new_row['ä¸»éšŠ']
        data_map[team] = new_row # ç”¨æ–°æ•¸æ“šè¦†è“‹èˆŠæ•¸æ“š

    final_data_list = list(data_map.values())

    # 4. å„²å­˜
    df_final = pd.DataFrame(final_data_list)
    df_final.to_csv(FILE_NAME, index=False, encoding='utf-8-sig')
    print(f"âœ… æ›´æ–°å®Œæˆï¼æ•¸æ“šå·²å„²å­˜è‡³ {FILE_NAME} (åŒ…å«è¿‘æ³èˆ‡æ’å)")

if __name__ == "__main__":
    update_csv()
